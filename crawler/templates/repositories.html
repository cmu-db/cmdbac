{% extends "base.html" %}
{% load staticfiles %}

{% block title %}
Repositories &raquo; Database Application Crawler
{% endblock %}

{% block main %}
{% include "status_codes.html" %}
<h2 class="page-header">Repositories</h2>

<form action="{% url 'repositories' %}" method="get">
    <div style="float:left">
    {{ result_form }}
    </div>

    <div style="float:left">
    {{ type_form }}
    </div>

    <div style="float:right">
    <input class="btn btn-primary btn-lg" type="submit" value="Filter"/>
    </div>
    <div style="float:right">
        <b>Name:</b>
    <input type="Search" placeholder='Search by full name' value='{{ search }}' class="form-control" name='search'/>
    </div>
</form>


<div class="table-responsive" style="clear:both;">
    <table class="table table-striped">
        <thead>
            <tr>
                <th><a href="?order_by={% if order_by == "name" %}-{% endif %}name&amp;{{ queries_no_page_order.urlencode }}">Full Name</th>
                <th><a href="?order_by={% if order_by != "-attempts_count" %}-{% endif %}attempts_count&;{{queries_no_page_order.urlencode }}"> # of Attempts</th>
                <th><a href="?order_by={% if order_by != "-latest_attempt__start_time" %}-{% endif %}latest_attempt__start_time&;{{queries_no_page_order.urlencode }}">Latest Attempt Date</th>
                <th><a href="?order_by={% if order_by != "-commits_count" %}-{% endif %}commits_count&amp;{{ queries_no_page_order.urlencode }}"># of Commits</th>
                <th><a href="?order_by={% if order_by == "repo_type__name" %}-{% endif %}repo_type__name&amp;{{ queries_no_page_order.urlencode }}">Type</th>
                <th><a href="?order_by={% if order_by == "latest_attempt__result__name" %}-{% endif %}latest_attempt__result__name&amp;{{ queries_no_page_order.urlencode }}">Result</th>
                <th>GitHub</th>
            </tr>
        </thead>
        <tbody>
            {% if repositories %}
                {% for repository in repositories %}
                <tr>
                    <td><a id="{{ repository.name}}" href="{% url 'repository' repository.get_user_name repository.get_repo_name %}?{{ queries.urlencode }}">{{ repository.name }}</a></td>
                    <td>{{repository.attempts_count}}</td>
                    {% if repository.latest_attempt %}
                        <td>{{repository.latest_attempt.start_time|date:'Y-m-d H:i:s' }}</td>
                    {% else %}
                        <td>-
                    {% endif %}
                    <td>{{ repository.commits_count }}</td>
                    {% if repository.repo_type.name == "Django" %}
                        <td><img src="{% static "img/django.jpg" %}" alt="Django" width="24" height="24"/></td>
                    {% elif repository.repo_type.name == "Ruby on Rails" %}
                        <td><img src="{% static "img/ruby_on_rails.jpg" %}" alt="Ruby on Rails" width="24" height="24"/></td>
                    {% endif %}

                    <td>
                    {% if not repository.latest_attempt %}
                        <span class="label label-info">No Attempt</span>
                    {% else %}
                        <a id="{{repository.latest_attempt.id}}" href="{% url 'attempt' repository.latest_attempt.id %}?{{ queries.urlencode }}" class="label label-{{ repository.latest_attempt.result_label }}">{{repository.latest_attempt.result_name}}</a>
                        <a href="#" data-toggle="modal" data-target="#statusModal">?</a>
                    {% endif %}
                    </td>

                    <td><a href="https://github.com/{{ repository.name }}"><img src="{% static "img/github.png" %}" alt="Github" width="24" height="24"/></a></td>
                </tr>
                {% endfor %}
            {% endif %}
        </tbody>
    </table>
</div>

<ul id="pagination-demo" class="pagination-sm"></ul>

<script type='text/javascript'>
    $('#pagination-demo').twbsPagination({
        totalPages: {{ repositories.paginator.num_pages }},
        visiblePages: 10,
        href: '?page={% templatetag openvariable %}number{% templatetag closevariable %}&{{ queries_no_page.urlencode }}',
        onPageClick: function (event, page) {
            $('#page-content').text('Page ' + page);
        }
    });
</script>

{% endblock %}
