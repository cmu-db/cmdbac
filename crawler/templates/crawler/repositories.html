{% extends "crawler/base.html" %}
{% load staticfiles %}
{% block main %}
<h1 class="page-header">Repositories</h1>

<form action="{% url 'repositories' %}" method="get">
    <div style="float:left">
    {{ result_form }}
    </div>

    <div style="float:left">
    {{ type_form }}
    </div>

    <div style="float:right">
    <input class="btn btn-primary btn-lg" type="submit" value="Filter"/>
    </div>
    <div style="float:right">
        <b>Name:</b>
    <input type="Search" placeholder='Search by full name' value='{{ search }}' class="form-control" name='search'/>
    </div>
</form>


<div class="table-responsive" style="clear:both;">
    <table class="table table-striped">
        <thead>
            <tr>
                <th><a href="?order_by={% if order_by == "full_name" %}-{% endif %}full_name&amp;{{ queries_no_page_order.urlencode }}">Full Name</th>
                    <th><a href="?order_by={% if order_by != "-attempts_count" %}-{% endif %}attempts_count&;{{queries_no_page_order.urlencode }}"> # of Attempts</th>
                    <th><a href="?order_by={% if order_by != "-latest_attempt__start_time" %}-{% endif %}latest_attempt__start_time&;{{queries_no_page_order.urlencode }}">Latest Attempt Date</th>
                <th><a href="?order_by={% if order_by != "-commits_count" %}-{% endif %}commits_count&amp;{{ queries_no_page_order.urlencode }}"># of Commits</th>
                    <th><a href="?order_by={% if order_by == "repo_type__name" %}-{% endif %}repo_type__name&amp;{{ queries_no_page_order.urlencode }}">Type</th>
                    <th><a href="?order_by={% if order_by == "latest_attempt__result__name" %}-{% endif %}latest_attempt__result__name&amp;{{ queries_no_page_order.urlencode }}">Result</th>
                <th>GitHub</th>
            </tr>
        </thead>
        <tbody>
                {% if repositories %}
                {% for repository in repositories %}
                <tr>
                    <td><a id="{{ repository.full_name}}" href="{% url 'repository' repository.get_user_name repository.get_repo_name %}?{{ queries.urlencode }}">{{ repository.full_name }}</a></td>
                    <td>{{repository.attempts_count}}</td>
                    {% if repository.latest_attempt %}
                        <td>{{repository.latest_attempt.start_time|date:'Y-m-d H:i:s' }}</td>
                    {% else %}
                        <td>-
                    {% endif %}
                    <td>{{ repository.commits_count }}</td>
                    {% if repository.repo_type.name == "Django" %}
                        <td><img src="{% static "crawler/django.jpg" %}" alt="Django" width="24" height="24"/></td>
                    {% elif repository.repo_type.name == "Ruby on Rails" %}
                        <td><img src="{% static "crawler/ruby_on_rails.jpg" %}" alt="Ruby on Rails" width="24" height="24"/></td>
                    {% endif %}

                    {% if not repository.latest_attempt %}
                        <td><span class="label label-info">No Attempt</span></td>
                    {% elif repository.latest_attempt.result.name == "Success" %}
                        <td><a href="{% url 'attempt' repository.latest_attempt.id %}" class="label label-success">{{repository.latest_attempt.result.name}}</a></td>
                    {% elif repository.latest_attempt.result.name == "Running Error" or repository.latest_attempt.result.name == "Missing Dependencies" %}
                        <td><a href="{% url 'attempt' repository.latest_attempt.id %}" class="label label-danger">{{repository.latest_attempt.result.name}}</a></td>
                    {% elif repository.latest_attempt.result.name == "Deploying" %}
                        <td><a href="{% url 'attempt' repository.latest_attempt.id %}" class="label label-info">{{repository.latest_attempt.result.name}}</a></td>
                    {% else %}
                        <td><a href="{% url 'attempt' repository.latest_attempt.id %}" class="label label-warning">{{repository.latest_attempt.result.name}}</a></td>
                    {% endif %}
                    <td><a href="https://github.com/{{ repository.full_name }}"><img src="{% static "crawler/github.png" %}" alt="Github" width="24" height="24"/></a></td>
                </tr>
                {% endfor %}
                {% endif %}
        </tbody>
    </table>
</div>

<div class="pagination">
    <span class="step-links">
        {% if repositories.has_previous %}
            <a href="?page={{ repositories.previous_page_number }}&amp;{{ queries_no_page.urlencode }}">previous</a>
        {% endif %}

        <span class="current">
            Page {{ repositories.number }} of {{ repositories.paginator.num_pages }}.
        </span>

        {% if repositories.has_next %}
            <a href="?page={{ repositories.next_page_number }}&amp;{{ queries_no_page.urlencode }}">next</a>
        {% endif %}
    </span>
</div>
{% endblock %}
